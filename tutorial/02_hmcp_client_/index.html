
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://amitv-innovaccer.github.io/Healthcare-MCP/tutorial/02_hmcp_client_/" rel="canonical"/>
<link href="../01_hmcp_server_/" rel="prev"/>
<link href="../03_authentication__oauth___jwt__/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.12" name="generator"/>
<title>02 HMCP Client - Healthcare-MCP Docs</title>
<link href="../../assets/stylesheets/main.2afb09e1.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#chapter-2-hmcp-client">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Healthcare-MCP Docs" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Healthcare-MCP Docs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Healthcare-MCP Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              02 HMCP Client
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../specification/">
          
  
  
  Specification

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../specification/hmcp_python_sdk/">
          
  
  
  SDK

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
  Tutorial

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Healthcare-MCP Docs" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Healthcare-MCP Docs">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Healthcare-MCP Docs
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Specification
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Specification
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/">
<span class="md-ellipsis">
    Introduction
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/context/">
<span class="md-ellipsis">
    Context
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/auth/">
<span class="md-ellipsis">
    Auth
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/hmcp_auth_vs_mcp_auth/">
<span class="md-ellipsis">
    HMCP Auth vs MCP Auth
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/guardrails/">
<span class="md-ellipsis">
    Guardrails
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/sampling/">
<span class="md-ellipsis">
    Sampling
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    SDK
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            SDK
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/hmcp_python_sdk/">
<span class="md-ellipsis">
    HMCP Python SDK
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../specification/examples/">
<span class="md-ellipsis">
    HMCP Examples
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Tutorial
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Introduction
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01_hmcp_server_/">
<span class="md-ellipsis">
    01 HMCP Server
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    02 HMCP Client
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    02 HMCP Client
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-the-big-idea">
<span class="md-ellipsis">
      What's the Big Idea?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-is-the-hmcp-client">
<span class="md-ellipsis">
      What is the HMCP Client?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-use-the-hmcp-client">
<span class="md-ellipsis">
      How to Use the HMCP Client
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works-under-the-hood">
<span class="md-ellipsis">
      How it Works Under the Hood
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
<span class="md-ellipsis">
      Conclusion
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_authentication__oauth___jwt__/">
<span class="md-ellipsis">
    03 Authentication (OAuth &amp; JWT)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_sampling_functionality_/">
<span class="md-ellipsis">
    04 Sampling Functionality
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_guardrails_/">
<span class="md-ellipsis">
    05 Guardrails
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_auth_configuration_/">
<span class="md-ellipsis">
    06 Auth Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07_jwt_handler_/">
<span class="md-ellipsis">
    07 JWT Handler
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#whats-the-big-idea">
<span class="md-ellipsis">
      What's the Big Idea?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-is-the-hmcp-client">
<span class="md-ellipsis">
      What is the HMCP Client?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-to-use-the-hmcp-client">
<span class="md-ellipsis">
      How to Use the HMCP Client
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#how-it-works-under-the-hood">
<span class="md-ellipsis">
      How it Works Under the Hood
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
<span class="md-ellipsis">
      Conclusion
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="chapter-2-hmcp-client">Chapter 2: HMCP Client</h1>
<p>In <a href="../01_hmcp_server_/">Chapter 1: HMCP Server</a>, we met the <strong>HMCP Server</strong> â€“ the central brain or specialized help desk manager in our Healthcare-MCP system. It listens for requests, checks permissions, and can even generate text summaries.</p>
<p>But how does an application, like our smart doctor's assistant, actually <em>talk</em> to this server? It needs a way to connect and send its requests. That's where the <strong>HMCP Client</strong> comes in!</p>
<h2 id="whats-the-big-idea">What's the Big Idea?</h2>
<p>Imagine you need to call that specialized hospital help desk (our HMCP Server). You can't just shout down the hallway; you need a phone or a specific communication device. You also need to know the right extension number and the correct way to phrase your request, especially if you're asking for something complex like drafting a document.</p>
<p>The <strong>HMCP Client</strong> is like that specialized communication device for your application. It's the software component your application uses to:</p>
<ol>
<li><strong>Connect:</strong> Establish a connection to the correct HMCP Server.</li>
<li><strong>Authenticate:</strong> Prove it has permission to talk to the server (we'll cover this more in <a href="../03_authentication__oauth___jwt__/">Chapter 3: Authentication (OAuth &amp; JWT)</a>).</li>
<li><strong>Send Requests:</strong> Send standard requests (like asking for information) using the basic MCP rules.</li>
<li><strong>Send <em>Special</em> Requests:</strong> Specifically, it knows how to ask the server to generate text using the <code>createMessage</code> request (which triggers the server's <a href="../04_sampling_functionality_/">Sampling Functionality</a>).</li>
</ol>
<p>Think of it as the friendly assistant program that knows <em>exactly</em> how to format a request for the HMCP Server, including the special "please generate text for me" requests.</p>
<h2 id="what-is-the-hmcp-client">What is the HMCP Client?</h2>
<p>The HMCP Client is a software component built upon a more general <code>MCP ClientSession</code>. The <code>ClientSession</code> handles the basic network connection and communication rules (MCP). The <code>HMCPClient</code> adds the specific knowledge needed to interact with an <em>HMCP</em> Server, particularly for sending text generation requests.</p>
<p>It bundles up your application's requests into the correct format, sends them over the network connection managed by the <code>ClientSession</code>, and then unpacks the server's response for your application to use.</p>
<h2 id="how-to-use-the-hmcp-client">How to Use the HMCP Client</h2>
<p>Let's see how our doctor's assistant application might use the <code>HMCPClient</code> to ask the server to draft a simple patient message.</p>
<p><em>(Note: Setting up the initial connection and authentication involves steps we'll cover in <a href="../03_authentication__oauth___jwt__/">Chapter 3: Authentication (OAuth &amp; JWT)</a>. For now, let's assume we already have a connected and authenticated <code>ClientSession</code> called <code>my_session</code>.)</em></p>
<p><strong>1. Create the HMCPClient Wrapper:</strong></p>
<p>Once you have a working connection (<code>my_session</code>), you wrap it with <code>HMCPClient</code> to get the extra features.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Import the necessary class</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hmcp.mcpclient.hmcp_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">HMCPClient</span>
<span class="c1"># Assume 'my_session' is an already connected and authenticated ClientSession</span>
<span class="c1"># (We'll learn how to create 'my_session' in Chapter 3!)</span>

<span class="c1"># Create the HMCPClient using the existing session</span>
<span class="n">hmcp_client</span> <span class="o">=</span> <span class="n">HMCPClient</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">my_session</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"HMCPClient is ready to send requests!"</span><span class="p">)</span>
</code></pre></div>
<p><strong>Explanation:</strong></p>
<ul>
<li>We import the <code>HMCPClient</code> class.</li>
<li>We create an instance of <code>HMCPClient</code>, giving it the <code>my_session</code> object that handles the actual network communication.</li>
<li>Now, <code>hmcp_client</code> has methods specific to HMCP, like asking for text generation.</li>
</ul>
<p><strong>2. Ask the Server to Generate Text (<code>create_message</code>):</strong></p>
<p>Now, let's use our <code>hmcp_client</code> to ask the server to generate a short message based on a prompt.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">mcp.types</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">types</span> <span class="c1"># Import types for message formatting</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span> <span class="c1"># Needed to run asynchronous code</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ask_server_to_write</span><span class="p">():</span>
    <span class="c1"># Define the conversation history/prompt</span>
    <span class="n">messages_to_send</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">types</span><span class="o">.</span><span class="n">SamplingMessage</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">"user"</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s2">"Draft a brief reminder for a patient about their upcoming check-up tomorrow at 10 AM."</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Sending request to server to draft a message..."</span><span class="p">)</span>
    <span class="c1"># Use the HMCP Client to send the 'createMessage' request</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">hmcp_client</span><span class="o">.</span><span class="n">create_message</span><span class="p">(</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages_to_send</span><span class="p">,</span>
        <span class="n">maxTokens</span><span class="o">=</span><span class="mi">50</span> <span class="c1"># Limit the response length</span>
    <span class="p">)</span>

    <span class="c1"># Check if the server sent back a successful result</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">CreateMessageResult</span><span class="p">):</span>
        <span class="c1"># Print the generated text from the assistant</span>
        <span class="n">generated_message</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Server Response:</span><span class="se">\n</span><span class="si">{</span><span class="n">generated_message</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Or print an error if something went wrong</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Server returned an error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># To run this async function in a simple script:</span>
<span class="c1"># asyncio.run(ask_server_to_write())</span>
</code></pre></div>
<p><strong>Explanation:</strong></p>
<ul>
<li>We import <code>types</code> to correctly format the messages we send.</li>
<li>We create a list called <code>messages_to_send</code>. Here, it just contains one message from the "user" (our application) asking the server to draft a reminder.</li>
<li>We call the <code>hmcp_client.create_message()</code> method. This is the special HMCP function!<ul>
<li><code>messages</code>: We pass our list of messages.</li>
<li><code>maxTokens</code>: We tell the server to keep the generated response relatively short.</li>
</ul>
</li>
<li>The <code>await</code> keyword means our program waits politely for the server's response.</li>
<li>We check the <code>response</code>. If it's a <code>CreateMessageResult</code>, we print the generated text found inside <code>response.choices[0].message.content</code>. If not, we print the error message.</li>
</ul>
<p><strong>Expected Output (Example):</strong></p>
<div class="highlight"><pre><span></span><code>Sending request to server to draft a message...
Server Response:
Hi [Patient Name], this is a friendly reminder about your check-up appointment tomorrow at 10:00 AM. We look forward to seeing you!
</code></pre></div>
<p><em>(The exact text will depend on the AI model configured on the <a href="../01_hmcp_server_/">HMCP Server</a> and its <a href="../04_sampling_functionality_/">Sampling Functionality</a>.)</em></p>
<h2 id="how-it-works-under-the-hood">How it Works Under the Hood</h2>
<p>What happens when you call <code>hmcp_client.create_message()</code>?</p>
<p><strong>The Flow:</strong></p>
<ol>
<li><strong>Packaging:</strong> The <code>HMCPClient</code> takes the details you provided (messages, maxTokens, etc.) and packages them into a specific format called a <code>CreateMessageRequest</code>. This is like putting your request into a standardized envelope.</li>
<li><strong>Sending:</strong> The <code>HMCPClient</code> tells the underlying <code>ClientSession</code> (the basic communication handler) to send this packaged request over the established network connection to the HMCP Server.</li>
<li><strong>Server Processing:</strong> The <a href="../01_hmcp_server_/">HMCP Server</a> receives the request. It first checks authentication (using info from <a href="../03_authentication__oauth___jwt__/">Chapter 3: Authentication (OAuth &amp; JWT)</a>). If okay, it understands it's a <code>CreateMessageRequest</code> and uses its text generation logic (<a href="../04_sampling_functionality_/">Sampling Functionality</a>) to create the response.</li>
<li><strong>Receiving:</strong> The <code>ClientSession</code> on the client side receives the response packet from the server.</li>
<li><strong>Unpacking:</strong> The <code>HMCPClient</code> (or the <code>ClientSession</code> it uses) unpacks the response, checks if it's the expected type (<code>CreateMessageResult</code> or an <code>ErrorData</code>), and returns it to your application code.</li>
</ol>
<p><strong>Sequence Diagram:</strong></p>
<p>Here's a simplified view of the <code>create_message</code> call:</p>
<div class="mermaid">sequenceDiagram
    participant App as Your Application
    participant HClient as HMCPClient
    participant Session as ClientSession
    participant HServer as HMCP Server

    App-&gt;&gt;+HClient: create_message(messages, ...)
    HClient-&gt;&gt;+Session: Format CreateMessageRequest
    Session-&gt;&gt;+HServer: Send Request over Network
    Note right of HServer: Server Authenticates,<br/>Processes Request,<br/>Generates Text
    HServer--&gt;&gt;-Session: Send Response (Generated Text or Error)
    Session--&gt;&gt;-HClient: Receive Response
    HClient--&gt;&gt;-App: Return CreateMessageResult or ErrorData
</div>
<p><strong>Key Code Components:</strong></p>
<ul>
<li>
<p><strong><code>HMCPClient</code> Class (<code>src/hmcp/mcpclient/hmcp_client.py</code>):</strong></p>
<ul>
<li>The <code>__init__</code> method simply stores the <code>ClientSession</code> that handles the connection.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Inside src/hmcp/mcpclient/hmcp_client.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HMCPClient</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">ClientSession</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Initialize using an existing MCP ClientSession."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span> <span class="c1"># Store the session for communication</span>
</code></pre></div>
<ul>
<li>The <code>create_message</code> method builds the request object and uses the session to send it.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Inside src/hmcp/mcpclient/hmcp_client.py</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_message</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">SamplingMessage</span><span class="p">],</span>
    <span class="c1"># ... other parameters like maxTokens ...</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">CreateMessageResult</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">ErrorData</span><span class="p">]:</span>

    <span class="c1"># 1. Package parameters into the standard format</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">CreateMessageRequestParams</span><span class="p">(</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="c1"># ... maxTokens, temperature, etc. ...</span>
    <span class="p">)</span>

    <span class="c1"># 2. Create the specific request type</span>
    <span class="n">createMessageRequest</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">CreateMessageRequest</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">"sampling/createMessage"</span><span class="p">,</span> <span class="c1"># Standard name for this request</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sending sampling request: </span><span class="si">{</span><span class="n">createMessageRequest</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># 3. Use the session to send the request and get the response</span>
    <span class="c1">#    It expects either a CreateMessageResult or an error.</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span>
        <span class="n">types</span><span class="o">.</span><span class="n">ClientRequest</span><span class="p">(</span><span class="n">createMessageRequest</span><span class="p">),</span> 
        <span class="n">types</span><span class="o">.</span><span class="n">CreateMessageResult</span>
    <span class="p">)</span>
</code></pre></div>
</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>You've now met the <strong>HMCP Client</strong>, the application's tool for communicating with the HMCP Server. You learned that it builds on a basic connection (<code>ClientSession</code>) and adds the specific ability to send requests like <code>create_message</code> to ask the server for generated text. We saw how to wrap a session with <code>HMCPClient</code> and use <code>create_message</code> to interact with the server's sampling capabilities.</p>
<p>But how does the client get permission to talk to the server in the first place? How does the server know who the client is and what it's allowed to do? That crucial step is <strong>Authentication</strong>. In the next chapter, we'll explore how the HMCP framework handles security using industry standards.</p>
<p>Let's dive into <a href="../03_authentication__oauth___jwt__/">Chapter 3: Authentication (OAuth &amp; JWT)</a>!</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.highlight", "search.suggest"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>